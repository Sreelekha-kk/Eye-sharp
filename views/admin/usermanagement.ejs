<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Modernize Free</title>
  <link rel="shortcut icon" type="image/png" href="/admin/assets/images/logos/favicon.png" />
  <link rel="stylesheet" href="/admin/assets/css/styles.min.css" />
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.js"></script></head>

<body>
  <!--  Body Wrapper -->
  <div class="page-wrapper" id="main-wrapper" data-layout="vertical" data-navbarbg="skin6" data-sidebartype="full"
    data-sidebar-position="fixed" data-header-position="fixed">
    <%-include('./includes/sidebar.ejs')%>
    <!--  Main wrapper -->
    <div class="body-wrapper">
      <!--  Header Start -->
      <%-include("./includes/header.ejs")%>
      <!--  Header End -->

  
      <section class="content-main container-fluid">
        <div class="content-header">
            <h2 class="content-title">Users list</h2>
        </div>
        <div class="card mb-4">
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover" id="myTable">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Mobile</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% user.forEach(user => { %>
                                <tr>
                                    <td width="20%"><%= user.name %></td>
                                    <td width="20%"><%= user.email %></td>
                                    <td><%= user.mobile %></td>
                                    <td class="border-bottom-0">
                                        <div class="d-flex align-items-center gap-2">
                                            <% if (user.is_blocked) { %>
                                                <button class="btn btn-danger">
                                                    <a onclick="unBlockUser('<%= user._id %>')">Unblock User</a>
                                                </button>
                                            <% } else { %>
                                                <button class="btn btn-dark">
                                                    <a class="alert-success" onclick="blockUser('<%= user._id %>')">Block User</a>
                                                </button>
                                            <% } %>
                                        </div>
                                        <div class="d-flex align-items-center gap-2">
                                        </div>
                                    </td>
                                </tr>
                            <% }) %>
                        </tbody>
                    </table> <!-- table-responsive.// -->
                </div>
            </div> <!-- card-body end// -->
        </div> <!-- card end// -->
        <div class="pagination-area mt-15 mb-50">
            <nav aria-label="Page navigation example">
                <ul class="pagination justify-content-start">
                    <% if (page > 1) { %>
                        <li class="page-item active">
                            <a class="page-link" href="/admin/users?page=<%= page - 1 %>&pageSize=<%= pageSize %>">Pre</a>
                        </li>
                    <% } %>
                    <% for (let i = 1; i <= totalPages; i++) { %>
                        <% if (i === page) { %>
                            <li class="page-item active"><span><%= i %></span></li>
                        <% } else { %>
                            <li class="page-item active">
                                <a class="page-link" href="/admin/users?page=<%= i %>&pageSize=<%= pageSize %>"><%= i %></a>
                            </li>
                        <% } %>
                    <% } %>
                    <% if (page < totalPages) { %>
                        <li class="page-item active">
                            <a class="page-link" href="/admin/users?page=<%= page + 1 %>&pageSize=<%= pageSize %>" style="width: 45px;">Next</a>
                        </li>
                    <% } %>
                </ul>
            </nav>
        </div>
    </section>
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.js"></script>


  <script>
    function blockUser(userId){
        Swal.fire({
            title: 'Are you sure to Block?',
            text: "",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Yes,Block!',
            timer: 4000
        }).then((result) => {
            if (result.isConfirmed) {
                $.ajax({
                    url:'/admin/blockUser',
                    method:'post',
                    data: {
                        userId: userId,
                    },
                    success:(response) => {
                        if(response){
                            location.reload()
                        }
                    }
                })
            }
        })
    }

    function unBlockUser(userId){
        Swal.fire({
            title: 'Are you sure to Unblock?',
            text: "",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Yes,Unblock!',
            timer: 3000
        }).then((result) => {
            if (result.isConfirmed) {
                $.ajax({
                    url:'/admin/unBlockUser',
                    method:'post',
                    data: {
                        userId: userId,
                    },
                    success:(response) => {
                        if(response){
                            location.reload()
                        }
                    }
                })
            }
        })
    }

  </script>


  <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  


<script>
 $(document).ready(function() {
  console.log("Initializing DataTables");
  var table = $('#myTable').DataTable({
    "paging": true,
    "pageLength": 10,
    "lengthMenu": [10, 25, 50, 75, 100],
  });

  table.on('draw', function() {
    console.log("Table redrawn");
    $(".paginate_button:not(.previous):not(.next)").addClass("number_button");
  });
});
</script>



<script src="/admin/assets/libs/jquery/dist/jquery.min.js"></script>
<script src="/admin/assets/libs/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
<script src="/admin/assets/js/sidebarmenu.js"></script>
<script src="/admin/assets/js/app.min.js"></script>
<script src="/admin/assets/libs/apexcharts/dist/apexcharts.min.js"></script>
<script src="/admin/assets/libs/simplebar/dist/simplebar.js"></script>
<script src="/admin/assets/js/dashboard.js"></script>

</body>

</html>